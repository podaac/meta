name: Sync Iteration to TVA

on:
  schedule:
    - cron: "*/10 * * * *"   # every 10 minutes
  workflow_dispatch:

jobs:
  sync-iteration:
    runs-on: ubuntu-latest
    environment: podaac projects
    permissions:
      issues: read
      contents: read

    steps:
      - name: Sync iteration to TVA
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.PROJECTS_TOKEN }}
          script: |
            const ORG = "podaac";
            const TVA_PROJECT_NUMBER = 74; // TVA project number

            const ALLOWED_SOURCE_PROJECTS = [
              "hitide-25.4",
              "SOTO PI 25.4"
            ];
            
            for (const sourceName of ALLOWED_SOURCE_PROJECTS) {
              const sourceProject = await getProjectByTitle(sourceName);
              if (!sourceProject) continue;

              const items = await getItems(sourceProject.id);

              for (const item of items) {
                console.log(`Processing item: ${item.title}`);
              }

            

            console.log("Iteration synced to TVA");